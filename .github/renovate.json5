{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: ["config:recommended"],
  platformAutomerge: false,
  lockFileMaintenance: {
    enabled: true,
    schedule: ["before 6am on monday"],
  },
  nix: {
    enabled: true,
  },
  customManagers: [
    {
      customType: "regex",
      fileMatch: ["\\.nix$"],
      matchStrings: [
        "# renovate: datasource=(?<datasource>[^\\s]+) depName=(?<depName>[^\\s]+)\\n\\s*rev\\s*=\\s*\"(?<currentDigest>[a-f0-9]{40})\"",
      ],
    },
  ],
  packageRules: [
    // vim/neovimプラグイン
    {
      groupName: "vim-plugins",
      matchManagers: ["custom.regex"],
      matchDatasources: ["git-refs"],
      automerge: true,
    },
    // nixpkgs関連をグループ化
    {
      groupName: "nixpkgs",
      matchManagers: ["nix"],
      matchPackagePatterns: ["^nixpkgs"],
      automerge: true,
    },
    // NixOS専用パッケージ
    {
      groupName: "nixos",
      matchManagers: ["nix"],
      matchPackageNames: ["nixos-hardware", "xremap"],
      automerge: true,
    },
    // Darwin専用パッケージ
    {
      groupName: "darwin",
      matchManagers: ["nix"],
      matchPackageNames: ["nix-darwin", "brew-nix", "brew-api", "mac-app-util"],
      automerge: true,
    },
    // home-manager関連パッケージ
    {
      groupName: "home-manager",
      matchManagers: ["nix"],
      matchPackageNames: [
        "home-manager",
        "alacritty-theme",
        "zen-browser",
        "firefox-addons",
        "nixCats",
      ],
      automerge: true,
    },
    // 共通/基盤パッケージ
    {
      groupName: "nix-common",
      matchManagers: ["nix"],
      matchPackageNames: [
        "flake-parts",
        "treefmt-nix",
        "sops-nix",
        "my-nur",
        "systems",
        "edgepkgs",
        "mcp-servers-nix",
      ],
      automerge: true,
    },
    // その他のflake inputsは個別にautomerge
    {
      matchManagers: ["nix"],
      automerge: true,
      automergeType: "pr",
      automergeStrategy: "squash",
    },
  ],
}
